"use strict";var _e=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var ot=_e((Qt,nt)=>{"use strict";var bt=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),mt=bt(()=>{}),$e=typeof Map=="function"&&Map.prototype,be=Object.getOwnPropertyDescriptor&&$e?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,fe=$e&&be&&typeof be.get=="function"?be.get:null,Me=$e&&Map.prototype.forEach,je=typeof Set=="function"&&Set.prototype,me=Object.getOwnPropertyDescriptor&&je?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,he=je&&me&&typeof me.get=="function"?me.get:null,Pe=je&&Set.prototype.forEach,wt=typeof WeakMap=="function"&&WeakMap.prototype,oe=wt?WeakMap.prototype.has:null,St=typeof WeakSet=="function"&&WeakSet.prototype,se=St?WeakSet.prototype.has:null,Et=typeof WeakRef=="function"&&WeakRef.prototype,Ue=Et?WeakRef.prototype.deref:null,vt=Boolean.prototype.valueOf,Tt=Object.prototype.toString,Rt=Function.prototype.toString,kt=String.prototype.match,Oe=String.prototype.slice,Y=String.prototype.replace,$t=String.prototype.toUpperCase,Le=String.prototype.toLowerCase,Ke=RegExp.prototype.test,We=Array.prototype.concat,W=Array.prototype.join,jt=Array.prototype.slice,Ge=Math.floor,Ee=typeof BigInt=="function"?BigInt.prototype.valueOf:null,we=Object.getOwnPropertySymbols,ve=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,te=typeof Symbol=="function"&&typeof Symbol.iterator=="object",A=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===te?"object":"symbol")?Symbol.toStringTag:null,Ye=Object.prototype.propertyIsEnumerable,Ve=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function He(e,r){if(e===1/0||e===-1/0||e!==e||e&&e>-1e3&&e<1e3||Ke.call(/e/,r))return r;var f=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof e=="number"){var d=e<0?-Ge(-e):Ge(e);if(d!==e){var m=String(d),a=Oe.call(r,m.length+1);return Y.call(m,f,"$&_")+"."+Y.call(Y.call(a,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Y.call(r,f,"$&_")}var Te=mt(),Je=Te.custom,Qe=et(Je)?Je:null;nt.exports=function e(r,f,d,m){var a=f||{};if(K(a,"quoteStyle")&&a.quoteStyle!=="single"&&a.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(K(a,"maxStringLength")&&(typeof a.maxStringLength=="number"?a.maxStringLength<0&&a.maxStringLength!==1/0:a.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var B=K(a,"customInspect")?a.customInspect:!0;if(typeof B!="boolean"&&B!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(K(a,"indent")&&a.indent!==null&&a.indent!=="	"&&!(parseInt(a.indent,10)===a.indent&&a.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(K(a,"numericSeparator")&&typeof a.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var v=a.numericSeparator;if(typeof r>"u")return"undefined";if(r===null)return"null";if(typeof r=="boolean")return r?"true":"false";if(typeof r=="string")return rt(r,a);if(typeof r=="number"){if(r===0)return 1/0/r>0?"0":"-0";var j=String(r);return v?He(r,j):j}if(typeof r=="bigint"){var o=String(r)+"n";return v?He(r,o):o}var G=typeof a.depth>"u"?5:a.depth;if(typeof d>"u"&&(d=0),d>=G&&G>0&&typeof r=="object")return Re(r)?"[Array]":"[Object]";var _=Ht(a,d);if(typeof m>"u")m=[];else if(tt(m,r)>=0)return"[Circular]";function S(l,y,q){if(y&&(m=jt.call(m),m.push(y)),q){var T={depth:a.depth};return K(a,"quoteStyle")&&(T.quoteStyle=a.quoteStyle),e(l,T,d+1,m)}return e(l,a,d+1,m)}if(typeof r=="function"&&!Xe(r)){var N=Bt(r),O=ue(r,S);return"[Function"+(N?": "+N:" (anonymous)")+"]"+(O.length>0?" { "+W.call(O,", ")+" }":"")}if(et(r)){var V=te?Y.call(String(r),/^(Symbol\(.*\))_[^)]*$/,"$1"):ve.call(r);return typeof r=="object"&&!te?ne(V):V}if(Wt(r)){for(var R="<"+Le.call(String(r.nodeName)),U=r.attributes||[],L=0;L<U.length;L++)R+=" "+U[L].name+"="+Ze(Ot(U[L].value),"double",a);return R+=">",r.childNodes&&r.childNodes.length&&(R+="..."),R+="</"+Le.call(String(r.nodeName))+">",R}if(Re(r)){if(r.length===0)return"[]";var H=ue(r,S);return _&&!Vt(H)?"["+ke(H,_)+"]":"[ "+W.call(H,", ")+" ]"}if(At(r)){var J=ue(r,S);return!("cause"in Error.prototype)&&"cause"in r&&!Ye.call(r,"cause")?"{ ["+String(r)+"] "+W.call(We.call("[cause]: "+S(r.cause),J),", ")+" }":J.length===0?"["+String(r)+"]":"{ ["+String(r)+"] "+W.call(J,", ")+" }"}if(typeof r=="object"&&B){if(Qe&&typeof r[Qe]=="function"&&Te)return Te(r,{depth:G-d});if(B!=="symbol"&&typeof r.inspect=="function")return r.inspect()}if(Ct(r)){var P=[];return Me&&Me.call(r,function(l,y){P.push(S(y,r,!0)+" => "+S(l,r))}),ze("Map",fe.call(r),P,_)}if(Ut(r)){var z=[];return Pe&&Pe.call(r,function(l){z.push(S(l,r))}),ze("Set",he.call(r),z,_)}if(Mt(r))return Se("WeakMap");if(Lt(r))return Se("WeakSet");if(Pt(r))return Se("WeakRef");if(Ft(r))return ne(S(Number(r)));if(Nt(r))return ne(S(Ee.call(r)));if(Dt(r))return ne(vt.call(r));if(xt(r))return ne(S(String(r)));if(!qt(r)&&!Xe(r)){var Q=ue(r,S),C=Ve?Ve(r)===Object.prototype:r instanceof Object||r.constructor===Object,M=r instanceof Object?"":"null prototype",i=!C&&A&&Object(r)===r&&A in r?Oe.call(Z(r),8,-1):M?"Object":"",c=C||typeof r.constructor!="function"?"":r.constructor.name?r.constructor.name+" ":"",p=c+(i||M?"["+W.call(We.call([],i||[],M||[]),": ")+"] ":"");return Q.length===0?p+"{}":_?p+"{"+ke(Q,_)+"}":p+"{ "+W.call(Q,", ")+" }"}return String(r)};function Ze(e,r,f){var d=(f.quoteStyle||r)==="double"?'"':"'";return d+e+d}function Ot(e){return Y.call(String(e),/"/g,"&quot;")}function Re(e){return Z(e)==="[object Array]"&&(!A||!(typeof e=="object"&&A in e))}function qt(e){return Z(e)==="[object Date]"&&(!A||!(typeof e=="object"&&A in e))}function Xe(e){return Z(e)==="[object RegExp]"&&(!A||!(typeof e=="object"&&A in e))}function At(e){return Z(e)==="[object Error]"&&(!A||!(typeof e=="object"&&A in e))}function xt(e){return Z(e)==="[object String]"&&(!A||!(typeof e=="object"&&A in e))}function Ft(e){return Z(e)==="[object Number]"&&(!A||!(typeof e=="object"&&A in e))}function Dt(e){return Z(e)==="[object Boolean]"&&(!A||!(typeof e=="object"&&A in e))}function et(e){if(te)return e&&typeof e=="object"&&e instanceof Symbol;if(typeof e=="symbol")return!0;if(!e||typeof e!="object"||!ve)return!1;try{return ve.call(e),!0}catch{}return!1}function Nt(e){if(!e||typeof e!="object"||!Ee)return!1;try{return Ee.call(e),!0}catch{}return!1}var It=Object.prototype.hasOwnProperty||function(e){return e in this};function K(e,r){return It.call(e,r)}function Z(e){return Tt.call(e)}function Bt(e){if(e.name)return e.name;var r=kt.call(Rt.call(e),/^function\s*([\w$]+)/);return r?r[1]:null}function tt(e,r){if(e.indexOf)return e.indexOf(r);for(var f=0,d=e.length;f<d;f++)if(e[f]===r)return f;return-1}function Ct(e){if(!fe||!e||typeof e!="object")return!1;try{fe.call(e);try{he.call(e)}catch{return!0}return e instanceof Map}catch{}return!1}function Mt(e){if(!oe||!e||typeof e!="object")return!1;try{oe.call(e,oe);try{se.call(e,se)}catch{return!0}return e instanceof WeakMap}catch{}return!1}function Pt(e){if(!Ue||!e||typeof e!="object")return!1;try{return Ue.call(e),!0}catch{}return!1}function Ut(e){if(!he||!e||typeof e!="object")return!1;try{he.call(e);try{fe.call(e)}catch{return!0}return e instanceof Set}catch{}return!1}function Lt(e){if(!se||!e||typeof e!="object")return!1;try{se.call(e,se);try{oe.call(e,oe)}catch{return!0}return e instanceof WeakSet}catch{}return!1}function Wt(e){return!e||typeof e!="object"?!1:typeof HTMLElement<"u"&&e instanceof HTMLElement?!0:typeof e.nodeName=="string"&&typeof e.getAttribute=="function"}function rt(e,r){if(e.length>r.maxStringLength){var f=e.length-r.maxStringLength,d="... "+f+" more character"+(f>1?"s":"");return rt(Oe.call(e,0,r.maxStringLength),r)+d}var m=Y.call(Y.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Gt);return Ze(m,"single",r)}function Gt(e){var r=e.charCodeAt(0),f={8:"b",9:"t",10:"n",12:"f",13:"r"}[r];return f?"\\"+f:"\\x"+(r<16?"0":"")+$t.call(r.toString(16))}function ne(e){return"Object("+e+")"}function Se(e){return e+" { ? }"}function ze(e,r,f,d){var m=d?ke(f,d):W.call(f,", ");return e+" ("+r+") {"+m+"}"}function Vt(e){for(var r=0;r<e.length;r++)if(tt(e[r],`
`)>=0)return!1;return!0}function Ht(e,r){var f;if(e.indent==="	")f="	";else if(typeof e.indent=="number"&&e.indent>0)f=W.call(Array(e.indent+1)," ");else return null;return{base:f,prev:W.call(Array(r+1),f)}}function ke(e,r){if(e.length===0)return"";var f=`
`+r.prev+r.base;return f+W.call(e,","+f)+`
`+r.prev}function ue(e,r){var f=Re(e),d=[];if(f){d.length=e.length;for(var m=0;m<e.length;m++)d[m]=K(e,m)?r(e[m],e):""}var a=typeof we=="function"?we(e):[],B;if(te){B={};for(var v=0;v<a.length;v++)B["$"+a[v]]=a[v]}for(var j in e)!K(e,j)||f&&String(Number(j))===j&&j<e.length||te&&B["$"+j]instanceof Symbol||(Ke.call(/[^\w$]/,j)?d.push(r(j,e)+": "+r(e[j],e)):d.push(j+": "+r(e[j],e)));if(typeof we=="function")for(var o=0;o<a.length;o++)Ye.call(e,a[o])&&d.push("["+r(a[o])+"]: "+r(e[a[o]],e));return d}});var st=_e((qe,Ae)=>{"use strict";(function(e){var r=String.fromCharCode,f={}.toString,d=e.SharedArrayBuffer,m=d?f.call(d):"",a=e.Uint8Array,B=a?f.call(ArrayBuffer.prototype):"",v=e.Buffer,j=/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,o=new Uint16Array(32);try{!v&&e.require&&(v=e.require("Buffer"));var G=v.prototype,_=v?f.call(G):""}catch{}var S=!!a&&!v,N=!v||!!a&&a.prototype.isPrototypeOf(G),O=e.TextEncoder,V=e.TextDecoder;if(S||v){var R=function(i){return i.TextDecoder=V||Q,i.TextEncoder=O||J,i!==e&&(i.decode=V?U(new V,"decode"):z,i.encode=O?U(M,"encode"):H,i.encodeInto=C),i},U=function(i,c,p){return p=i[c],function(){return p.apply(i,arguments)}},L=function(i,c){var p=i===void 0?"":(""+i).replace(j,P),l=p.length|0,y=0,q=0,T=c.length|0,b=i.length|0;T<l&&(l=T);e:for(;y<l;y=y+1|0){switch(i=p.charCodeAt(y)|0,i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:q=q+1|0;case 8:case 9:case 10:case 11:break;case 12:case 13:if((y+1|0)<T){q=q+1|0;break}case 14:if((y+2|0)<T){q=q+1|0;break}case 15:if((y+3|0)<T){q=q+1|0;break}default:break e}c[y]=i}return{written:y,read:b<q?b:q}},H=function(i){i=i===void 0?"":(""+i).replace(j,P);for(var c=i.length|0,p=S?new a(c):v.allocUnsafe?v.allocUnsafe(c):new v(c),l=0;l<c;l=l+1|0)p[l]=i.charCodeAt(l)|0;return p},J=function(){},P=function(i){var c=i.charCodeAt(0)|0;if(55296<=c&&56319>=c)if(i=i.charCodeAt(1)|0,56320<=i&&57343>=i){if(c=(c<<10)+i-56613888|0,65535<c)return r(240|c>>18,128|c>>12&63,128|c>>6&63,128|c&63)}else c=65533;return 2047>=c?r(192|c>>6,128|c&63):r(224|c>>12,128|c>>6&63,128|c&63)},z=function(i){var c=i&&i.buffer||i,p=f.call(c);if(p!==B&&p!==_&&p!==m&&p!=="[object ArrayBuffer]"&&i!==void 0)throw TypeError("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");i=N?new a(c):c||[],p=c="";for(var l=0,y=i.length|0,q=y-32|0,T,b,k=0,X=0,I,F=0,D=-1;l<y;){for(T=l<=q?32:y-l|0;F<T;l=l+1|0,F=F+1|0){switch(b=i[l]&255,b>>4){case 15:if(I=i[l=l+1|0]&255,I>>6!==2||247<b){l=l-1|0;break}k=(b&7)<<6|I&63,X=5,b=256;case 14:I=i[l=l+1|0]&255,k<<=6,k|=(b&15)<<6|I&63,X=I>>6===2?X+4|0:24,b=b+256&768;case 13:case 12:I=i[l=l+1|0]&255,k<<=6,k|=(b&31)<<6|I&63,X=X+7|0,l<y&&I>>6===2&&k>>X&&1114112>k?(b=k,k=k-65536|0,0<=k&&(D=(k>>10)+55296|0,b=(k&1023)+56320|0,31>F?(o[F]=D,F=F+1|0,D=-1):(I=D,D=b,b=I))):(b>>=8,l=l-b-1|0,b=65533),k=X=0,T=l<=q?32:y-l|0;default:o[F]=b;continue;case 11:case 10:case 9:case 8:}o[F]=65533}if(p+=r(o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7],o[8],o[9],o[10],o[11],o[12],o[13],o[14],o[15],o[16],o[17],o[18],o[19],o[20],o[21],o[22],o[23],o[24],o[25],o[26],o[27],o[28],o[29],o[30],o[31]),32>F&&(p=p.slice(0,F-32|0)),l<y){if(o[0]=D,F=~D>>>31,D=-1,p.length<c.length)continue}else D!==-1&&(p+=r(D));c+=p,p=""}return c},Q=function(){};Q.prototype.decode=z,d=J.prototype,d.encode=H;var C=d.encodeInto=L;if(O){var M=new O;C=M.encodeInto?U(M,"encode"):O.prototype.encodeInto=function(i,c){var p=i.length|0,l=c.length|0;if(p<l>>1){var y=M.encode(i);if((y.length|0)<l)return c.set(y),{read:p,written:y.length|0}}return L(i,c)}}typeof qe=="object"&&typeof Ae<"u"?R(Ae.exports):typeof define==typeof R&&typeof define=="function"&&define.amd?define(function(){return R({})}):R(e)}})(typeof global>"u"?typeof self>"u"?qe||{}:self:global)});var at=_e((Xt,it)=>{"use strict";it.exports=function({host:e,utility:r},f,d){let B="edgio-config",v="edgio-origins",j="edgio-usrvar",o=Symbol("edgio-id"),G=Symbol("done"),_=Symbol("options"),S=Symbol("headers"),N=Symbol("body-used"),O=Symbol("body-defined"),V=Symbol("get-body"),R=Symbol("namespace"),U=Symbol("append-fn"),L=Symbol("check-fn"),H=Symbol("get-fn"),J=Symbol("keys-fn"),P=Symbol("redirected"),z=Symbol("remove-fn"),Q=Symbol("set-fn"),C=Symbol("url"),M=Symbol("error-code"),i="Internal Error: ",c=ot(),p=0,l=2,y=()=>" ".repeat(p);function q(n,...t){if(n(y()),t.length>0){let s=t[0];typeof s=="string"&&(t.shift(),s=s.replace(/%[oOdisf]/g,u=>{if(t.length===0)return u;let h=t.shift();switch(u){case"%o":case"%O":return c(h);case"%d":case"%i":return parseInt(h,10).toString();case"%s":return h.toString();case"%f":return parseFloat(h).toString();default:return u}}),t.unshift(s))}for(let s=0;s<t.length;s++){s!==0&&n(" ");let u=t[s],h=typeof u;switch(h){case"string":n(u);break;case"number":case"function":n(u.toString());break;case"boolean":n(u?"true":"false");break;case"undefined":case"null":n(h);break;default:n(u===null?"null":c(u));break}}n(`
`)}function T(n,...t){let s=r.stream_write_all.bind(this,n);try{return q(s,...t)}catch(u){s("Exception during console output: "),s(u.toString()),s(`
`)}}let b=new Map;globalThis.console={assert:function(n,...t){n||T(2,"Assertion failed:",...t)},clear:function(){},count:function(n){b.set(n,(b.get(n)||0)+1),globalThis.console.log(`${n}: ${b.get(n)}`)},countReset:function(n){b.set(n,0)},debug:T.bind(globalThis.console,1),dir:function(...n){return globalThis.console.log(...n)},dirxml:function(...n){return globalThis.console.log(...n)},error:T.bind(globalThis.console,2),group:function(...n){n!==void 0&&globalThis.console.log(...n),p+=l},groupCollapsed:function(...n){return globalThis.console.group(...n)},groupEnd:function(){p=Math.max(p-l,0)},info:T.bind(globalThis.console,1),log:T.bind(globalThis.console,1),profile:function(){},table:function(n,t){return globalThis.console.warn("table not implemented",n,t)},time:function(){},timeEnd:function(n){return globalThis.console.warn("timeEnd not implemented",n)},timeLog:function(n){return globalThis.console.warn("timeLog not implemented",n)},timeStamp:function(){},trace:T.bind(globalThis.console,1),warn:T.bind(globalThis.console,2)};class k{static BUFFER_SIZE=1024;constructor(t,s){if(this.constructor==k)throw new Error(`${i}EdgioReadableStreamReader Abstract class cannot be instantiated directly.`);this[o]=t,this[V]=s,this[G]=!1}async read(){let t=new Uint8Array(this[V](this[o]));return this[G]=!0,{value:t}}}class X extends k{constructor(t){super(t,e.hostcall_resp_get_body)}}class I extends k{constructor(t){super(t,e.hostcall_req_get_body)}}class F{constructor(t){this[o]=t}getReader(){return new X(this[o])}}class D{constructor(t){this[o]=t}getReader(){return new I(this[o])}}class ie{constructor(t,s,{appendFn:u,checkFn:h,getFn:E,keysFn:g,removeFn:w,setFn:x}){if(this.constructor==ie)throw new Error(`${i}Headers Abstract class cannot be instantiated directly.`);if(this[o]=t,this[U]=u,this[L]=h,this[H]=E,this[J]=g,this[z]=w,this[Q]=x,Array.isArray(s))s.forEach($=>{if(!Array.isArray($))throw new Error(`When passing an array of headers, each array element must be an array of length = 2. '${$}' is type '${typeof $}' not type array.`);if($.length!==2)throw new Error(`When passing an array of headers, each array element must be an array of length = 2. '${$}' is array of length ${$.length}.`);e.hostcall_debug(`.append(${$})`),this.append($[0],$[1])});else{if(s&&Function.prototype.toString.call(s.constructor).match(/class.*/))throw new Error(`'headers' must be a dictionary or an array of array pairs. Found ${Function.prototype.toString.call(s.constructor)}`);if(typeof s=="object")Object.keys(s).forEach($=>{this.append($,s[$])});else if(typeof s<"u")throw new Error(`'headers' must be a dictionary or an array of array pairs. Found type ${typeof s}.`)}}_validateName(t){if(t===void 0)throw new Error("The 'name' argument is required, but was not present.");if(typeof t!="string")throw new Error(`The 'name' argument must be a 'string' type, not a '${typeof t}' type.`);return t}_validateValue(t){if(t===void 0)throw new Error("The 'value' argument is required, but was not present.");if(typeof t!="string"&&!Array.isArray(t))throw new Error(`The 'value' argument must be a 'string' or 'array' type, not a '${typeof t}' type.`);return t}append(t,s){this[U](this[o],this._validateName(t),this._validateValue(s))}delete(t){this[z](this[o],this._validateName(t))}entries(){let t=[];for(let s of this.keys())t.push([s,this.get(s)]);return t}forEach(t){for(let s of this.keys())t(this.get(s),s)}get(t){let s=this[H](this[o],this._validateName(t));return Array.isArray(s)?s.join(", "):typeof s>"u"?null:s}has(t){return this[L](this[o],this._validateName(t))}keys(){return this[J](this[o])}set(t,s){this[Q](this[o],this._validateName(t),this._validateValue(s))}values(){let t=[];for(let s of this.keys())t.push(this.get(s));return t}toJSON(){let t={};for(let s of this.keys())t[s]=this.get(s);return t}}class xe extends ie{constructor(t,s){super(t,s,{appendFn:e.hostcall_resp_append_header,checkFn:e.hostcall_resp_check_header,getFn:e.hostcall_resp_get_header_values,keysFn:r.resp_get_header_names,removeFn:e.hostcall_resp_remove_header,setFn:e.hostcall_resp_set_header})}}class Fe extends ie{constructor(t,s){super(t,s,{appendFn:e.hostcall_req_append_header,checkFn:e.hostcall_req_check_header,getFn:e.hostcall_req_get_header_values,keysFn:r.req_get_header_names,removeFn:e.hostcall_req_remove_header,setFn:e.hostcall_req_set_header})}}globalThis.Request=class{constructor(n,t){var E,g,w;if(this[_]=t||{},typeof((E=t==null?void 0:t.edgio)==null?void 0:E.id)=="number"){this[o]=(g=t==null?void 0:t.edgio)==null?void 0:g.id,this[S]=new Fe(this[o]),e.hostcall_debug(`sdk.js:Request(${n}, ${JSON.stringify(t)}) id: ${this[o]}`);return}if(typeof n!="string")throw new Error(`"string" type is accepted for the input parameter, not '${typeof n}'`);let s=n;if(this[_].method!==void 0&&typeof this[_].method!="string")throw new Error(`options.method must be type 'undefined' or 'string', not '${typeof this[_].method}'`);let u=this[_].method||"GET";this[o]=e.hostcall_req_create(u,s),this[S]=new Fe(this[o],((w=this[_])==null?void 0:w.headers)||{});let h=this[_].body;if(delete this[_].body,this[N]=!1,h){if(u==="GET"||u==="HEAD")throw new Error("Request with GET/HEAD method cannot have body.");typeof h=="string"?(e.hostcall_debug(`new Request(${this[o]}, string: ${h})`),e.hostcall_req_set_body_from_string(this[o],h)):h instanceof ArrayBuffer?(e.hostcall_debug(`new Request(ArrayBuffer: len=${h.byteLength})`),e.hostcall_req_set_body_from_array_buffer(this[o],h)):ArrayBuffer.isView(h)?(e.hostcall_debug(`new Request(TypedArray: len=${h.byteLength})`),e.hostcall_req_set_body_from_array_buffer(this[o],h.buffer)):(e.hostcall_debug(`new Request(other: ${h.toString()})`),e.hostcall_req_set_body_from_string(this[o],h.toString()))}e.hostcall_debug(`sdk.js:Request(${n}, ${JSON.stringify(t)}) id: ${this[o]}`)}async arrayBuffer(){let t=await new D(this[o]).getReader().read();return t.done?new ArrayBuffer(0):(this[N]=!0,t.value.buffer)}blob(){throw new Error(`${i}The 'blob' method is not supported by the Request class.`)}get body(){return this.method==="GET"||this.method==="HEAD"?null:new D(this[o])}get bodyUsed(){return this[N]}get cache(){throw new Error(`${i}The 'cache' property is not supported by the Request class.`)}get credentials(){throw new Error(`${i}The 'credentials' property is not supported by the Request class.`)}clone(){throw new Error(`${i}The 'clone' method is not supported by the Request class.`)}get destination(){throw new Error(`${i}The 'destination' property is not supported by the Request class.`)}formData(){throw new Error(`${i}The 'formData' method is not supported by the Request class.`)}get headers(){return this[S]}get integrity(){throw new Error(`${i}The 'integrity' property is not supported by the Request class.`)}async json(){return JSON.parse(await this.text())}get method(){return e.hostcall_req_get_method(this[o])}set method(n){return e.hostcall_req_set_method(this[o],n)}get mode(){throw new Error(`${i}The 'mode' property is not supported by the Request class.`)}get redirect(){throw new Error(`${i}The 'redirect' property is not supported by the Request class.`)}get referrer(){throw new Error(`${i}The 'referrer' property is not supported by the Request class.`)}get referrerPolicy(){throw new Error(`${i}The 'referrerPolicy' property is not supported by the Request class.`)}get signal(){throw new Error(`${i}The 'signal' property is not supported by the Request class.`)}async text(){let t=await new D(this[o]).getReader().read();return t.done?"":(this[N]=!0,new de("utf-8").decode(t.value))}get url(){return e.hostcall_req_get_uri(this[o])}set url(n){return e.hostcall_req_set_uri(this[o],n)}get path(){return e.hostcall_req_get_path(this[o])}get edgioId(){return this[o]}toJSON(){return{method:this.method,url:this.url,headers:this.headers}}cloneWithoutBody(){let n=e.hostcall_req_clone_without_body(this[o]);return new Request(null,{edgio:{id:n}})}},globalThis.Response=class{constructor(n,t){var s,u,h,E,g;if(this[N]=!1,this[O]=!1,this[P]=!1,this[C]=null,typeof((s=t==null?void 0:t.edgio)==null?void 0:s.id)=="number"){this[o]=(u=t==null?void 0:t.edgio)==null?void 0:u.id,this[S]=new xe(this[o]),e.hostcall_debug(`_edgioNew Response: ${this[o]}`),this[O]=!0;return}if(this[_]=t||{},this[_].status=((h=this[_])==null?void 0:h.status)||200,this[_].status<200||this[_].status>599)throw new Error(`The status provided ${this[_].status} is outside of the standard range [200, 599].`);this[o]=e.hostcall_resp_create(this[_].status),this[S]=new xe(this[o],((E=this[_])==null?void 0:E.headers)||{}),e.hostcall_debug(`new Response: ${this[o]} ${JSON.stringify((g=this[_])==null?void 0:g.headers)}`),n&&(typeof n=="string"?(this[O]=!0,e.hostcall_debug(`new Response(string: ${n})`),e.hostcall_resp_set_body_from_string(this[o],n)):n instanceof ArrayBuffer?(this[O]=!0,e.hostcall_debug(`new Response(ArrayBuffer: len=${n.byteLength})`),e.hostcall_resp_set_body_from_array_buffer(this[o],n)):ArrayBuffer.isView(n)?(this[O]=!0,e.hostcall_debug(`new Response(TypedArray: len=${n.byteLength})`),e.hostcall_resp_set_body_from_array_buffer(this[o],n.buffer)):(this[O]=!0,e.hostcall_debug(`new Response(other: ${n.toString()})`),e.hostcall_resp_set_body_from_string(this[o],n.toString())))}async arrayBuffer(){if(this[O]){this[N]=!1;let n=await this.body.getReader().read();return n.done?new ArrayBuffer(0):n.value.buffer}return new ArrayBuffer(0)}blob(){throw new Error(`${i}The 'blob' method is not supported by the Response class.`)}get body(){return this[O]?new F(this[o]):null}get bodyUsed(){return this[N]}clone(){throw new Error(`${i}The 'clone' method is not supported by the Response class.`)}formData(){throw new Error(`${i}The 'formData' method is not supported by the Response class.`)}get headers(){return this[S]}async json(){return JSON.parse(await this.text())}get ok(){let n=this.status;return n>=200&&n<300}static redirect(n,t){return new Response(void 0,{headers:{location:n},status:t||302})}set redirected(n){this[P]=n}get redirected(){return this[P]}get status(){return e.hostcall_resp_get_status(this[o])}get statusText(){return e.hostcall_resp_get_reason(this[o])}async text(){if(this[N]=!0,!this[O])return"";let n=await this.body.getReader().read();return new de("utf-8").decode(n.value)}get type(){throw new Error(`${i}The 'type' property is not supported by the Response class.`)}get url(){return this[C]}get edgioId(){return this[o]}toJSON(){return{status:this.status,statusText:this.statusText,headers:this.headers}}cloneWithoutBody(){let n=e.hostcall_resp_clone_without_body(this[o]),t=new Response(null,{edgio:{id:n}});return t[C]=this[C],t[P]=this[P],t}},globalThis.OpaqueRedirect=class extends globalThis.Response{constructor(n,t){super("",{edgio:{id:n}}),this[S]={append:()=>{},delete:()=>{},entries:()=>[],forEach:()=>{},get:()=>null,has:()=>!1,keys:()=>[],set:()=>{},values:()=>[]},this[C]=t}get ok(){return!1}get status(){return 0}};class ct extends Error{constructor(t){super(),this[M]=t}get code(){return this[M]}get message(){return e.hostcall_resp_get_error_code_message(this[M])}toString(){return`${this.message} (code: ${this.code})`}}class De{constructor(t){this[R]=t}get(t){return e.hostcall_dict_get(this[R],t)}getBase64Decoded(t){return new Uint8Array(e.hostcall_dict_get_base64_decoded(this[R],t))}has(t){return e.hostcall_dict_check(this[R],t)}keys(){return r.dict_get_keys(this[R])}toJSON(){let t={};for(let s of this.keys())t[s]=this.get(s);return t}}class lt{constructor(t){this[R]=t}has(t){return e.hostcall_unique_set_check(this[R],t)}keys(){return r.unique_set_get_keys(this[R])}toJSON(){return this.keys()}}class ut{startTimer(t){return e.hostcall_metrics_start_timer(t)}stopTimer(t){return e.hostcall_metrics_stop_timer(t)}add(t,s){return e.hostcall_metrics_add(t,s)}}globalThis.edgio={env:new De(B),origins:new lt(v),usrvar:new De(j),metrics:new ut},globalThis.module={},globalThis.__dirname="/",globalThis.__filename="/index.js",globalThis.global=globalThis;let{TextEncoder:ft,TextDecoder:de}=st();globalThis.TextDecoder=de,globalThis.TextEncoder=ft,Object.defineProperties(globalThis.TextEncoder.prototype,{encoding:{get:function(){return"utf8"}}});let ee=[],re=!1,ae=null,ce=new Map,le=!1,Ne=0,pe=0;globalThis.addEventListener=function(n,t,s){n==="fetch"?ee.push(t):console.warn(`Unsupported event type: ${n}`)};function Ie(n,t){if(n.length!==t)throw new Error(`Expected ${t} arguments, got ${n.length}`)}function ht(n,t){if(n.length<t)throw new Error(`Expected at least ${t} arguments, got ${n.length}`)}function dt(n){return{type:"fetch",request:n,respondWith:function(t){if(Ie(arguments,1),t instanceof Response){let s=t;e.hostcall_debug("sdk.js respondWith: got response object, handle synchronously and return"),e.hostcall_resp_send_to_client(s.edgioId),le=!0;return}e.hostcall_debug("sdk.js respondWith: resolving response promise"),Promise.resolve(t).then(s=>(e.hostcall_resp_send_to_client(s.edgioId),le=!0,s)).catch(s=>{throw le=!1,new Error("Failed to resolve respondWith promise: "+s)})},waitUntil:function(t){Ie(arguments,1),++Ne,Promise.resolve(t).then(s=>(++pe,s)).catch(s=>{throw++pe,new Error("Failed to resolve waitUntil promise: "+s)})}}}function Be(n){let t=n.split("="),s=t[0].trim(),u=t[1];return{key:s,value:u}}function pt(n,t){let s={},u=n.headers.cookie;if(u){let g=u.split(";");for(let w=0;w<g.length;w++){let{key:x,value:$}=Be(g[w]);s[x]=$}}let h=t.headers.get("set-cookie")||[];Array.isArray(h)||(h=[h]);for(let g=0;g<h.length;g++){let{key:w,value:x}=Be(h[g].split(";")[0]);s[w]=x}let E=Object.keys(s);if(E.length>0){n.headers.cookie="";for(let g=0;g<E.length;g++){let w=E[g],x=s[w];n.headers.cookie+=`${w}=${x}${g<E.length-1?"; ":""}`}}}async function gt(n,t,s,u){let E=u.headers.get("location");if([301,302,303,307,308].indexOf(u.status)<0||!E)return u[C]=n,u.redirected=s>0,u;let g=t.redirect;if(g==="error")throw new Error("redirect");if(g==="manual")return new globalThis.OpaqueRedirect(u.edgioId,n);if(++s>5)throw new Error(`fetch(${n}) exceeded the limit of ${5} redirects.`);return pt(t,u),await Ce(E,t,s)}async function Ce(n,t,s){let u;n instanceof Request?u=n:u=new Request(n,t);try{e.hostcall_req_set_fetch_origin(u.edgioId,t.edgio.origin)}catch{throw new Error(`Invalid edgio.origin specified. Must be one of: ${edgio.origins.keys().join(",")}`)}e.hostcall_req_fetch_async(u.edgioId);let h,E,g=new Promise(($,ge)=>{h=$,E=ge});ce.set(u.edgioId,{promise:g,resolve:h,reject:E});let w=u.url,x=await g;return gt(w,t,s,x)}globalThis.fetch=async function(n,t){ht(arguments,1),t=t||{},t.redirect||(t.redirect="follow"),t.headers||(t.headers={}),t.edgio||(t.edgio={});let s=["error","follow","manual"];if(s.indexOf(t.redirect)<0)throw new Error(`redirect must be one of "${s.join(", ")}", not "${t.redirect}"`);if(!t.edgio.origin)throw new Error(`edgio.origin must be specified as a fetch option. Must be one of: ${edgio.origins.keys().join(",")}`);return Ce(n,t,0)};function yt(n){let t=edgio.env.get("__EDGE_FUNCTION_PATH__"),s=d.get(t);if(!s)throw new Error(`No edge function found for path: ${t}`);if(s().bind(globalThis)(),ee.length===0){e.hostcall_debug("No fetch listeners, returning immediately");return}e.hostcall_debug(`Got ${ee.length} fetch listeners`);let u=new Request(null,{edgio:{id:n}}),h=dt(u);function E(){return le&&pe>=Ne}for(;;){for(;!re&&ee.length>0;){let w=ee.shift()(h);if(w instanceof Promise&&(re=!0,w.then(()=>{re=!1}).catch(x=>{re=!1,ae=x})),E()){e.hostcall_debug("breaking the loop - no more jobs (1)");return}}if(e.hostcall_debug("Executing pending jobs..."),r.execute_pending(),ae){let g=ae;throw ae=null,g}if(ce.size===0){if(ee.length===0&&!re)return}else{let[g,w,x]=e.hostcall_resp_await_next();e.hostcall_debug(`sdk.js->hostcall_resp_await_next: is_response(${g}), req_id(${w}), resp_id_or_err_code(${x})`);let $=ce.get(w);if(!$)throw new Error(`No pending fetch for ID ${w}`);ce.delete(w);let{resolve:ge,reject:_t}=$;if(g){e.hostcall_debug("sdk.js: creating Response");let ye=new Response(null,{edgio:{id:x}});ge(ye)}else{e.hostcall_debug("sdk.js: creating ResponseError");let ye=new ct(x);_t(ye)}}if(E()){e.hostcall_debug("breaking the loop - no more jobs (2)");return}}}yt(f)}});module.exports=function(e,r){let f="__INSERT_EDGE_FUNCTIONS_MAP_HERE__";at()(e,r,f)};
//# sourceMappingURL=edgeFunctionsIndexCodeTemplate.js.map
