"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getConfig = void 0;
const paths_1 = require("./deploy/paths");
const utils_1 = require("./utils");
const log_1 = __importDefault(require("./log"));
let config;
/**
 * Returns the contents of edgio.config.js
 * @param reload Set to true to ensure that the config is reloaded from disk
 * @returns
 */
function getConfig(reload = false) {
    if (!config || reload) {
        const srcPath = (0, paths_1.getConfigSrcPath)();
        if (reload) {
            delete require.cache[srcPath];
        }
        config = (0, utils_1.nonWebpackRequire)(srcPath);
        // injected by build-lambda/src/jobs/deployBuild.js
        const environment = process.env.EDGIO_ENVIRONMENT_NAME;
        // apply config overrides for the current environment
        if (environment && config.environments && config.environments[environment]) {
            log_1.default.info(`using config overrides for ${environment}`);
            Object.assign(config, config.environments[environment]);
        }
    }
    return config;
}
exports.getConfig = getConfig;
